#' Search the Quandl database
#'
#' An authentication token is needed for access to the Quandl API multiple times. Set your \code{access_token} with \code{Quandl.api_key} function.
#'
#' For instructions on finding your authentication token go to https://www.quandl.com/account
#' @param query Search terms
#' @param page Specifies which page of results to return.
#' @param source Specifies a specific source to search within.
#' @param silent Prints the first few results when FALSE.
#' @param authcode Authentication Token for extended API access by default set by \code{\link{Quandl.api_key}}.
#' @return A list of the search results.
#' @references This R package uses the Quandl API. For more information go to http://www.quandl.com/help/api. For more help on the package itself go to http://www.quandl.com/help/r.
#' @author Raymond McTaggart
#' @seealso \code{\link{Quandl.api_key}}
#' @examples \dontrun{
#' search.results <- Quandl.search("oil")
#' }
#' @export
Quandl.search <- function(query, silent=FALSE, ...) {
  params <- list()
  params$query <- query
  params <- c(params, list(...))

  path = "datasets"
  json <- do.call(quandl.api, c(path=path, params))

  list <- list()
  length(list) <- length(json$datasets)

  if (length(json$datasets)>0) {
    for (i in 1:length(json$datasets)) {
      name <- json$datasets[i,]$name
      code <- paste(json$datasets[i,]$database_code, "/", json$datasets[i,]$dataset_code, sep="")
      desc <- json$datasets[i,]$description
      freq <- json$datasets[i,]$frequency
      colname <- json$datasets[i,]$column_names
      if (i < 4 & !silent) {
        cat(name, "\nCode: ", code, "\nDesc: ", desc, "\nFreq: ", freq, "\nCols: ", paste(colname, collapse="|"), "\n\n", sep="")
      }
      list[[i]]$name <- name
      list[[i]]$code <- code
      list[[i]]$description <- desc
      list[[i]]$frequency <- freq
      list[[i]]$column_names <- colname
      list[[i]]$from_date <- json$datasets[i,]$oldest_available_date
      list[[i]]$to_date <- json$datasets[i,]$newest_available_date
    }
  } else {
    warning("No datasets found")
  }

  invisible(list)
}
